<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Real Estate Price Calculator</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">

  
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }
    html {
    font-size: 18px;
    }

    @media (max-width: 768px) {
    html {
    font-size: 16px;
    }
    }

    body {
      margin: 0;
      background: url('https://aaferimmobilier.com/wp-content/uploads/2025/02/00c257dd-cd08-4e9b-934e-990d06a10096.jpeg') no-repeat center center fixed;
      background-size: cover;
      color: #000;
    }

    .overlay {
      background: rgba(0, 0, 0, 0.5);
      width: 100%;
      min-height: 100vh;
      padding: 20px;
    }

    .header {
  text-align: center;
  padding-top: 15px;
  padding-bottom: 0px;
}

.sticky-selectors {
  position: sticky;
  top: 10px;
  z-index: 999;
  display: flex;
  justify-content: right;
  gap: 15px;
  padding: 10px;
  margin-bottom: 10px;
}

.selectors select {
    padding: 6px 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
    background-color: rgba(255, 255, 255, 0.6); /* semi-transparent white */
    backdrop-filter: blur(4px); /* optional: adds glassy effect */
    }


body[lang="ar"] {
  direction: rtl;
  text-align: right;
}

    

    .logo {
  max-height: 320px;
  width: auto;
  height: auto;
  max-width: 100%;
  display: block;
  margin: 0 auto;
}

    #parkingPriceField {
   transition: all 0.3s ease;
    }


    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 20px;
      background-color: rgba(255, 255, 255, 0.756);
      padding: 20px;
      border-radius: 20px;
      max-width: 1000px;
      margin: 0 auto;
    }

    .field {
      margin-bottom: 5px;
    }

    .field label {
      display: block;
      margin-bottom: 5px;
    }

     .field input, .field select {
        width: 100%;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid #ccc;
        background-color: rgba(255, 255, 255, 0.6); /* glassy */
        backdrop-filter: blur(5px);
        }


     .results span {
        font-weight: bold;
        font-size: 16px;
        display: block;
        margin-top: 5px;
        padding: 10px;
        border-radius: 10px;
        background-color: rgba(208, 171, 128, 0.1); /* glassy for outputs */
        backdrop-filter: blur(5px);
        }


    .pdf-button {
      margin-top: 30px;
      text-align: center;
    }

    .pdf-button button {
      background-color: #000;
      color: #fff;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }

    .error-msg {
      color: red;
      font-size: 12px;
      margin-top: 5px;
    }
    .popup-overlay {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  }

  .popup-content {
  background: rgba(255, 255, 255, 0.6); /* glassy white */
  backdrop-filter: blur(6px);
  padding: 20px;
  border-radius: 20px;
  width: 300px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2); /* subtle depth */
}


.popup-content label {
  font-size: 14px;
  display: flex;
  flex-direction: column;
  }

.popup-buttons {
  display: flex;
  justify-content: space-between;
  margin-top: 10px;
  }
  select#hasParking {
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #ccc;
  width: 55%;
 }


/* Custom Button Styling */
button.generate-pdf {
  font-size: 18px;
  letter-spacing: 2px;
  text-transform: none;
  display: inline-block;
  text-align: center;
  font-weight: bold;
  padding: 0.7em 2em;
  border: 2px solid #916D48; /* 🟡 Gold border by default */
  border-radius: 10px;
  position: relative;
  box-shadow: 0 1px 10px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.1);
  color: #ffffff;
  background-color: #183153bc; /* 🔹 Navy background */
  text-decoration: none;
  transition: 0.3s ease all;
  z-index: 1;
  cursor: pointer;
}

button.generate-pdf:before {
  transition: 0.5s all ease;
  position: absolute;
  top: 0;
  left: 50%;
  right: 50%;
  bottom: 0;
  opacity: 0;
  content: '';
  background-color: #916D48; /* 🟡 Gold background on hover */
  z-index: -1;
  border-radius: 10px;
}

button.generate-pdf:hover,
button.generate-pdf:focus {
  border: 1px solid #d0ab80; /* 🔹 Navy border on hover */
  color: white;
}

button.generate-pdf:hover:before,
button.generate-pdf:focus:before {
  left: 0;
  right: 0;
  opacity: 1;
}

button.generate-pdf:active {
  transform: scale(0.96);
}

@keyframes scaleUp {
  0% { transform: scale(1); }
  50% { transform: scale(0.95); }
  100% { transform: scale(1); }
}



html[lang="ar"] * {
  font-family: 'Tajawal', sans-serif !important;
}


.floating-selectors {
  position: sticky;
  top: 10px;
  z-index: 999;
  width: 100%;
  display: flex;
  justify-content: space-between;
  padding: 0 20px;
}

.selector-left select,
.selector-right select {
  padding: 6px 10px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 14px;
  background-color: rgba(255, 255, 255, 0.6); /* glass effect */
  backdrop-filter: blur(4px);
}


input, select, textarea {
  border: 2px solid #d0ab80; /* Thin soft golden border (always visible) */
  border-radius: 10px;
  padding: 10px;
  box-sizing: border-box;
  outline: none;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.container input,
.container select,
.container textarea,
.field input,
.field select,
.field textarea,
.results input,
.results select {
  border: 1px solid #d0ab80; /* Soft golden border always visible */
  border-radius: 10px;
  padding: 10px;
  box-sizing: border-box;
  outline: none;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
}

.container input:focus,
.container select:focus,
.container textarea:focus,
.field input:focus,
.field select:focus,
.field textarea:focus,
.results input:focus,
.results select:focus {
  border-color: #b69265; /* Bolder on focus */
  box-shadow: 0 0 15px rgba(182, 146, 101, 0.5); /* golden glow */
}

.results span {
  display: block; /* makes it fill the line */
  width: 100%; /* forces full width like before */
  padding: 8px 12px;
  border: 1px solid #d0ab80;
  border-radius: 10px;
  background-color: #ffffff8c;
  box-sizing: border-box;
  font-weight: bold;
  color: #333;
  transition: box-shadow 0.3s ease;
  text-align: right;
}

.results span:hover {
  box-shadow: 0 0 15px rgba(182, 146, 101, 0.5); /* golden glow */
}


#languageSelector,
#currencySelector {
  border: 1px solid #d0ab80;
  border-radius: 10px;
  padding: 10px;
  background-color: #ffffff67;
  box-sizing: border-box;
  font-weight: bold;
  color: #333;
  transition: border-color 0.3s ease, box-shadow 0.3s ease;
}


#languageSelector:focus,
#currencySelector:focus {
  border-color: #b69265;
  box-shadow: 0 0 15px rgba(182, 146, 101, 0.5);
}

.field select#hasParking {
  border: 1px solid #d0ab80;
  border-radius: 10px;
  padding: 10px;
  background-color: #ffffff8c;
  box-sizing: border-box;
  font-weight: bold;
  color: #333;
  transition: border-color 0.8s ease, box-shadow 0.8s ease;
}

.field select#hasParking:focus {
  border-color: #b69265;
  box-shadow: 0 0 8px rgba(182, 146, 101, 0.8);
}


  </style>
</head>
<body>
  <div class="overlay">

    <div class="floating-selectors">
        <div class="selector-left">
          <select id="languageSelector">
            <option value="fr">🇫🇷 Français</option>
            <option value="en">🇬🇧 English</option>
            <option value="ar">🇲🇦 العربية</option>
            <option value="es">🇪🇸 Español</option>
            <option value="nl">🇳🇱 Nederlands</option>
            <option value="de">🇩🇪 Deutsch</option>
            <option value="zh">🇨🇳 中文</option>
          </select>
        </div>
        <div class="selector-right">
          <select id="currencySelector">
            <option value="MAD">🇲🇦 MAD</option>
            <option value="EUR">🇪🇺 EUR</option>
            <option value="USD">🇺🇸 USD</option>
          </select>
        </div>
      </div>

      
    <div class="header">
        <div class="logo-wrapper">
            <img class="logo" src="https://aaferimmobilier.com/wp-content/uploads/2022/01/logo-def-no-background.png" alt="Logo">
          </div>

    </div>

    <div class="container">
      <!-- LEFT COLUMN -->
      <div class="column">
        <div class="field">
          <label for="propertyType">Type de bien</label>
          <select id="propertyType">
            <option value="apartment">Appartement</option>
            <option value="terrace">Appartement avec terrasse</option>
            <option value="commercial">Local commercial</option>
          </select>
        </div>
    
        <div class="field">
          <label for="surface">Surface (m²)</label>
          <input type="number" id="surface" placeholder="e.g. 100 m²">
        </div>
    
        <div class="field" id="extraSurfaceField" style="display:none;">
          <label id="extraLabel">Terrasse/Mezzanine (m²)</label>
          <input type="number" id="extraSurface" placeholder="e.g. 50 m²">
        </div>
    
        <div class="field">
          <label for="priceM2">Prix/(m²)</label>
          <input type="number" id="priceM2" placeholder="e.g. 20 000 MAD">
        </div>
    
        <div class="field" style="display: flex; align-items: center; justify-content: space-between;">
          <label for="hasParking" id="labelHasParking" style="margin-right: 10px;">Place de parking ?</label>
          <select id="hasParking" style="width: 55%;">
            <option value="no">Non</option>
            <option value="yes">Oui</option>
          </select>
        </div>
        
    
        <div class="field" id="parkingPriceField" style="display: none;">
          <label for="parkingPrice" id="labelParkingPrice">Prix du parking</label>
          <input type="number" id="parkingPrice" placeholder="e.g. 150 000 MAD">
        </div>
      </div>
    
      <!-- RIGHT COLUMN -->
      <div class="column">
        <div class="field">
          <label for="paymentPercent">% Paiement initial</label>
          <input type="number" id="paymentPercent" placeholder="e.g. 30%">
        </div>
    
        <div class="field results">
          <label>Montant Total</label>
          <span id="totalPrice">0</span>
        </div>
    
        <div class="field results">
          <label>Paiement Initial</label>
          <span id="initialPayment">0</span>
        </div>
    
        <div class="field results">
          <label>Reste à Payer</label>
          <span id="remainingAmount">0</span>
        </div>
      </div>
    </div>
    

    <div style="text-align: center; margin-top: 20px;">
        <button class="generate-pdf" onclick="openPopup()">
            <span id="pdfButtonLabel">Generate PDF</span>
          </button>          
      </div>

    <div id="popupForm" style="display:none;" class="popup-overlay">
      <div class="popup-content">
        <h3>Informations du client</h3>
        <label>Nom du client: <input type="text" id="clientName" placeholder="Nom du client"/></label>
        <label>Téléphone: <input type="text" id="clientPhone" placeholder="Téléphone"/></label>
        <label>Projet: <input type="text" id="projectName" placeholder="Projet"/></label>
        <label>Bloc ~ Immeuble: <input type="text" id="block"placeholder="Bloc ~ Immeuble" /></label>
        <label>Étage: <input type="text" id="floor" placeholder="Étage" /></label>
        <label>Type d'appartement: <input type="text" id="apartmentType" placeholder="Type d'appartement"/></label>
        <div class="popup-buttons">
          <button onclick="generatePDF().catch(e => alert('Erreur PDF: ' + e.message))">Exporter</button>
          <button onclick="closePopup()">Annuler</button>
        </div>
      </div>
    </div>
    
  </div>

  <script>

function reshapeArabic(text) {
  return ArabicShaper.convert(text);  // this comes from the arabic-persian-reshaper library
}


    window._calculatedValues = {
  total: 0,
  initial: 0,
  remaining: 0
};

    let currentLang = "fr"; // default language
    const propertyType = document.getElementById('propertyType');
    const surfaceInput = document.getElementById('surface');
    const extraSurfaceInput = document.getElementById('extraSurface');
    const priceM2Input = document.getElementById('priceM2');
    const paymentPercentInput = document.getElementById('paymentPercent');
    const totalPriceEl = document.getElementById('totalPrice');
    const initialPaymentEl = document.getElementById('initialPayment');
    const remainingAmountEl = document.getElementById('remainingAmount');
    const extraSurfaceField = document.getElementById('extraSurfaceField');
    const extraLabel = document.getElementById('extraLabel');

    let exchangeRates = { EUR: 0.091, USD: 0.10, MAD: 1 };

    async function fetchExchangeRates() {
      try {
        const res = await fetch('https://api.exchangerate.host/latest?base=MAD');
        const data = await res.json();
        exchangeRates = data.rates || exchangeRates;
        calculate();
      } catch {
        alert("Erreur taux de change. Valeurs par défaut utilisées.");
      }
    }
    
    document.getElementById("parkingPrice").addEventListener("input", calculate);
        document.getElementById("hasParking").addEventListener("change", () => {
          const show = document.getElementById("hasParking").value === "yes";
          document.getElementById("parkingPriceField").style.display = show ? "block" : "none";
          calculate(); // recalculate after changing selection
        });

        document.getElementById("hasParking").addEventListener("change", function () {
  const show = this.value === "yes";
  const parkingInput = document.getElementById("parkingPrice");
  document.getElementById("parkingPriceField").style.display = show ? "block" : "none";

  if (!show) {
    parkingInput.value = ""; // clear the value when hidden
  }

  calculate(); // update all calculations
});

    function calculate() {
      const surface = parseFloat(surfaceInput.value) || 0;
      const extraSurface = parseFloat(extraSurfaceInput.value) || 0;
      const priceM2 = parseFloat(priceM2Input.value) || 0;
      const paymentPercent = parseFloat(paymentPercentInput.value) || 0;
      const hasParking = document.getElementById("hasParking").value === "yes";
      const parkingPrice = hasParking ? parseFloat(document.getElementById("parkingPrice").value) || 0 : 0;

      if (!surface || !priceM2) {
        totalPriceEl.textContent = initialPaymentEl.textContent = remainingAmountEl.textContent = '0';
        return;
      }

      let adjustedSurface = surface;
      if (propertyType.value !== 'apartment') adjustedSurface += extraSurface / 2;




      const total = adjustedSurface * priceM2 + parkingPrice;
      const initial = total * (paymentPercent / 100);
      const remaining = total - initial;

        // Store raw values globally for PDF use
        window._calculatedValues = {
        total,
        initial,
        remaining
        };


      const currency = document.getElementById('currencySelector').value;
      const rate = exchangeRates[currency] || 1;

      totalPriceEl.textContent = formatCurrency(total * rate, currency);
      initialPaymentEl.textContent = formatCurrency(initial * rate, currency);
      remainingAmountEl.textContent = formatCurrency(remaining * rate, currency);
    }

    function formatCurrency(value, currency) {
      return new Intl.NumberFormat(undefined, { style: 'currency', currency }).format(value);
    }
    const pdfText = {
  fr: {
    title: "Fiche de consultation immobilière",
    name: "Nom du client",
    phone: "Téléphone",
    project: "Projet",
    block: "Bloc",
    floor: "Étage",
    type: "Type",
    refSurface: "Surface (réf)",
    inputSurface: "Surface saisie",
    extra: "Surface supplémentaire",
    price: "Prix/(m²)",
    percent: "Paiement initial",
    total: "Montant total",
    upfront: "Paiement initial",
    remaining: "Reste à payer"
  },
  en: {
    title: "Real Estate Consultation Sheet",
    name: "Client Name",
    phone: "Phone Number",
    project: "Project",
    block: "Block",
    floor: "Floor",
    type: "Type",
    refSurface: "Reference Surface",
    inputSurface: "Entered Surface",
    extra: "Extra Surface",
    price: "Price per m²",
    percent: "Upfront Payment",
    total: "Total Amount",
    upfront: "Upfront Payment",
    remaining: "Remaining Amount"
  },
  ar: {
  title: "ﺔﻴﺭﺎﻘﻌﻟﺍ ﺓﺭﺍﺮﺸﺘﺳﺍ",
  name: "ﻥﻭﺯﺒﻟﺍ ﻢﺳﺇ",
  phone: "ﻒﺗﺍﻮﻬﻟﺍ ﻢﻗﺭ",
  project: "ﻊﻳﺮﺸﻤﻟﺍ",
  block: "ﺓﺭﺎﻤﻌﻟﺍ",
  floor: "ﻖﻄﻨﻤﻟﺍ",
  type: "ﻉﻮﻧ",
  refSurface: "(ﺔﻴﻌﻳﺮﻤﻟﺍ) ﺔﺤﺴﻣ",
  inputSurface: "ﺓﺎﺧﺩﺇ ﺔﺤﺴﻣ",
  extra: "ﺓﺎﻓﺎﺿﺇ ﺔﺤﺴﻣ",
  price: "ﻊﺑﺎﺴﻤﻟﺍ ﺮﺘﻤﻠﻟ ﺮﻌﺳ",
  percent: "ﻲﻠﻳﻭﺍ ﺊﻔﺩﻟﺍ ﺔﺑﺎﺴﻨﻧ",
  total: "ﻲﻠﻤﺠﻤﻟﺍ ﻍﻼﺒﻤﻟﺍ",
  upfront: "ﻯﻼﻋﻷﺍ ﺔﻔﻄﻟﻟﺍ ﺔﻌﻓﺩ",
  remaining: "ﻲﻘﺑﻟﺍ ﻍﻼﺒﻤﻟﺍ"
},
    es: {
    title: "Ficha de Consulta Inmobiliaria",
    name: "Nombre del cliente",
    phone: "Número de teléfono",
    project: "Proyecto",
    block: "Bloque",
    floor: "Piso",
    type: "Tipo",
    refSurface: "Superficie de referencia",
    inputSurface: "Superficie ingresada",
    extra: "Superficie adicional",
    price: "Precio por m²",
    percent: "Pago inicial",
    total: "Monto total",
    upfront: "Pago inicial",
    remaining: "Monto restante"
  }


  console.log("generatePDF triggered");

  const doc = new window.jspdf.jsPDF();


  // Translation dictionary
  

  


;
};
}

    function continueGeneratingPDF(doc) {
  const langText = pdfText[currentLang] || pdfText.fr;

  // Collect calculated values
  const surface = document.getElementById("surface").value;
  const extraSurface = document.getElementById("extraSurface").value;
  const price = document.getElementById("priceM2").value;
  const percent = document.getElementById("paymentPercent").value;
  const total = document.getElementById("totalPrice").textContent;
  const initial = document.getElementById("initialPayment").textContent;
  const remaining = document.getElementById("remainingAmount").textContent;
  const currency = document.getElementById("currencySelector").value;

  // Collect form input values
  const client = document.getElementById("clientName").value;
  const phone = document.getElementById("clientPhone").value;
  const project = document.getElementById("projectName").value;
  const block = document.getElementById("block").value;
  const floor = document.getElementById("floor").value;
  const type = document.getElementById("apartmentType").value;
  const refSurface = document.getElementById("refSurface").value;

  // Set direction for Arabic (RTL)
  if (currentLang === "ar") {
  doc.setFont("Tajawal", "normal"); // Use Tajawal font for Arabic
  doc.setFontSize(14);
  doc.text(reshapeArabic(langText.title), 200, 20, { align: "right" });

  doc.setFontSize(12);
  let y = 40;
  doc.text(reshapeArabic(`${langText.name}: ${client}`), 200, y, { align: "right", maxWidth: 180 });
  doc.text(reshapeArabic(`${langText.phone}: ${phone}`), 200, y += 10, { align: "right", maxWidth: 180 });
  doc.text(reshapeArabic(`${langText.project}: ${project}`), 200, y += 10, { align: "right", maxWidth: 180 });
  doc.text(reshapeArabic(`${langText.block}: ${block}`), 200, y += 10, { align: "right", maxWidth: 180 });
  doc.text(reshapeArabic(`${langText.floor}: ${floor}`), 200, y += 10, { align: "right", maxWidth: 180 });
  doc.text(reshapeArabic(`${langText.type}: ${type}`), 200, y += 10, { align: "right", maxWidth: 180 });
  doc.text(reshapeArabic(`${langText.refSurface}: ${refSurface} م²`), 200, y += 10, { align: "right", maxWidth: 180 });

  y += 20;
  doc.text(reshapeArabic(`${langText.inputSurface}: ${surface} م²`), 200, y += 10, { align: "right", maxWidth: 180 });
  if (extraSurface && extraSurface > 0) {
    doc.text(reshapeArabic(`${langText.extra}: ${extraSurface} م²`), 200, y += 10, { align: "right", maxWidth: 180 });
  }
  doc.text(reshapeArabic(`${langText.price}: ${price} ${currency}`), 200, y += 10, { align: "right", maxWidth: 180 });
  doc.text(reshapeArabic(`${langText.percent}: ${percent}%`), 200, y += 10, { align: "right", maxWidth: 180 });
  doc.text(reshapeArabic(`${langText.total}: ${total}`), 200, y += 20, { align: "right", maxWidth: 180 });
  doc.text(reshapeArabic(`${langText.upfront}: ${initial}`), 200, y += 10, { align: "right", maxWidth: 180 });
  doc.text(reshapeArabic(`${langText.remaining}: ${remaining}`), 200, y += 10, { align: "right", maxWidth: 180 });
}

  doc.setFontSize(8);
doc.setTextColor(90, 90, 90);
doc.text("GROUPE AAFER IMMOBILIER - ROUTE DE MALABATA, TANGIER OFFSHORE PLAZA, BORJ AL ANDALOUS I", 105, 280, { align: "center" });
doc.text("+212 539 944 323 | +212 660 370 388", 105, 285, { align: "center" });
doc.text("Lun-Ven 09h-17h · Sam 09h-13h", 105, 290, { align: "center" });

  doc.save("fiche-client.pdf");
  closePopup();

}

  </script>
  <script src="https://cdn.jsdelivr.net/npm/arabic-persian-reshaper@1.0.5/dist/arabic-persian-reshaper.min.js"></script>

</body>
</html>
